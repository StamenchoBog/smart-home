# CloudFront Distribution module

The module `aws_cloudfront_distribution` provides an CloudFront distribution resource.

## Module logic and accepted variables

The module accepts couple of variables and creates `aws_cloudfront_distribution` depending on their values. Certain variables have default values in order to match security guidelines and recommended policies and standards. Other variables have default values in order to be optional and not mandatory.

### Resources

| Name | Type |
|------|------|
| [aws_cloudfront_distribution.cf](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution) | resource |

### Variables

In the `variables.tf` file we can specify values as follows. Below is a table that has all variables accepted by the module, and their types, default values and if they are required or not.

| Name | Description | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Default | Required |
|------|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|:--------:|
| <a name="input_aliases"></a> [aliases](#input\_aliases) | n/a | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `null` |    no    |
| <a name="input_comment"></a> [comment](#input\_comment) | n/a | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `null` |    no    |
| <a name="input_custom_error_response"></a> [custom\_error\_response](#input\_custom\_error\_response) | n/a | <pre>list(object({<br>    error_caching_min_ttl = optional(number)<br>    error_code            = number<br>    response_code         = optional(number)<br>    response_page_path    = optional(string)<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `null` |    no    |
| <a name="input_default_cache_behavior"></a> [default\_cache\_behavior](#input\_default\_cache\_behavior) | n/a | <pre>object({<br>    allowed_methods           = list(string)<br>    cached_methods            = list(string)<br>    cache_policy_id           = optional(string)<br>    compress                  = optional(bool)<br>    default_ttl               = optional(number)<br>    field_level_encryption_id = optional(string)<br>    forwarded_values = optional(object({<br>      cookies = object({<br>        forward           = string<br>        whitelisted_names = optional(list(string))<br>      })<br>      headers                 = optional(list(string))<br>      query_string            = bool<br>      query_string_cache_keys = optional(list(string))<br>    }))<br>    lambda_function_associations = optional(list(object({<br>      event_type   = string<br>      lambda_arn   = string<br>      include_body = optional(bool)<br>    })))<br>    function_associations = optional(list(object({<br>      event_type   = string<br>      function_arn = string<br>    })))<br>    max_ttl                    = optional(number)<br>    min_ttl                    = optional(number)<br>    origin_request_policy_id   = optional(string)<br>    realtime_log_config_arn    = optional(string)<br>    response_headers_policy_id = optional(string)<br>    smooth_streaming           = optional(bool)<br>    target_origin_id           = string<br>    trusted_key_groups         = optional(list(string))<br>    trusted_signers            = optional(list(string))<br>    viewer_protocol_policy     = string<br>  })</pre>                                                  | n/a |   yes    |
| <a name="input_default_root_object"></a> [default\_root\_object](#input\_default\_root\_object) | n/a | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `null` |    no    |
| <a name="input_enabled"></a> [enabled](#input\_enabled) | n/a | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a |   yes    |
| <a name="input_http_version"></a> [http\_version](#input\_http\_version) | n/a | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `null` |    no    |
| <a name="input_is_ipv6_enabled"></a> [is\_ipv6\_enabled](#input\_is\_ipv6\_enabled) | n/a | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `null` |    no    |
| <a name="input_logging_config"></a> [logging\_config](#input\_logging\_config) | n/a | <pre>object({<br>    bucket          = string<br>    include_cookies = optional(bool)<br>    prefix          = optional(string)<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `null` |    no    |
| <a name="input_ordered_cache_behaviors"></a> [ordered\_cache\_behaviors](#input\_ordered\_cache\_behaviors) | n/a | <pre>list(object({<br>    allowed_methods           = list(string)<br>    cached_methods            = list(string)<br>    cache_policy_id           = optional(string)<br>    compress                  = optional(bool)<br>    default_ttl               = optional(number)<br>    field_level_encryption_id = optional(string)<br>    forwarded_values = optional(object({<br>      cookies = object({<br>        forward           = string<br>        whitelisted_names = optional(list(string))<br>      })<br>      headers                 = optional(list(string))<br>      query_string            = bool<br>      query_string_cache_keys = optional(list(string))<br>    }))<br>    lambda_function_associations = optional(list(object({<br>      event_type   = string<br>      lambda_arn   = string<br>      include_body = optional(bool)<br>    })))<br>    function_associations = optional(list(object({<br>      event_type   = string<br>      function_arn = string<br>    })))<br>    max_ttl                    = optional(number)<br>    min_ttl                    = optional(number)<br>    origin_request_policy_id   = optional(string)<br>    path_pattern               = string<br>    realtime_log_config_arn    = optional(string)<br>    response_headers_policy_id = optional(string)<br>    smooth_streaming           = optional(bool)<br>    target_origin_id           = string<br>    trusted_key_groups         = optional(list(string))<br>    trusted_signers            = optional(list(string))<br>    viewer_protocol_policy     = string<br>  }))</pre> | `null` |    no    |
| <a name="input_origin_groups"></a> [origin\_groups](#input\_origin\_groups) | n/a | <pre>list(object({<br>    origin_id = string<br>    failover_criteria = object({<br>      status_codes = list(string)<br>    })<br>    members = list(object({<br>      origin_id = string<br>    }))<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `null` |    no    |
| <a name="input_origins"></a> [origins](#input\_origins) | n/a | <pre>list(object({<br>    connection_attempts = optional(number)<br>    connection_timeout  = optional(number)<br>    custom_origin_config = object({<br>      http_port                = number<br>      https_port               = number<br>      origin_protocol_policy   = string<br>      origin_ssl_protocols     = list(string)<br>      origin_keepalive_timeout = optional(number)<br>      origin_read_timeout      = optional(number)<br>    })<br>    domain_name = string<br>    custom_headers = optional(list(object({<br>      name  = string<br>      value = string<br>    })))<br>    origin_access_control_id = optional(string)<br>    origin_id                = string<br>    origin_path              = optional(string)<br>    origin_shield = optional(object({<br>      enabled              = bool<br>      origin_shield_region = string<br>    }))<br>    s3_origin_config = optional(object({<br>      origin_access_identity = string<br>    }))<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | n/a |   yes    |
| <a name="input_price_class"></a> [price\_class](#input\_price\_class) | n/a | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `null` |    no    |
| <a name="input_restrictions"></a> [restrictions](#input\_restrictions) | n/a | <pre>object({<br>    geo_restriction = object({<br>      locations        = list(string)<br>      restriction_type = string<br>    })<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a |   yes    |
| <a name="input_retain_on_delete"></a> [retain\_on\_delete](#input\_retain\_on\_delete) | n/a | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `null` |    no    |
| <a name="input_tags"></a> [tags](#input\_tags) | n/a | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `null` |   yes    |
| <a name="input_viewer_certificate"></a> [viewer\_certificate](#input\_viewer\_certificate) | n/a | <pre>object({<br>    # Specify acm_certificate_arn, cloudfront_default_certificate or iam_certificate_id<br>    acm_certificate_arn            = optional(string)<br>    cloudfront_default_certificate = optional(bool)<br>    iam_certificate_id             = optional(string)<br>    minimum_protocol_version       = string<br>    ssl_support_method             = optional(string)<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | <pre>{<br>  "cloudfront_default_certificate": false,<br>  "minimum_protocol_version": "TLSv1.2_2018"<br>}</pre> |    no    |
| <a name="input_wait_for_deployment"></a> [wait\_for\_deployment](#input\_wait\_for\_deployment) | n/a | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `null` |    no    |
| <a name="input_web_acl_id"></a> [web\_acl\_id](#input\_web\_acl\_id) | n/a | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `null` |    no    |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_arn"></a> [arn](#output\_arn) | The ARN (Amazon Resource Name) for the distribution. For example: arn:aws:cloudfront::123456789012:distribution/EDFDVBD632BHDS5, where 123456789012 is your AWS account ID. |
| <a name="output_id"></a> [id](#output\_id) | The identifier for the distribution. For example: EDFDVBD632BHDS5. |
| <a name="output_status"></a> [status](#output\_status) | The current status of the distribution. Deployed if the distribution's information is fully propagated throughout the Amazon CloudFront system. |

## Usage

Example for `main.tf` file:

```terraform
module "cf_distribution" {
  source = "../../modules/cloudfront_distribution"
  origins = [
    {
      domain_name              = aws_s3_bucket.b.bucket_regional_domain_name
      origin_access_control_id = aws_cloudfront_origin_access_control.default.id
      origin_id                = local.s3_origin_id
    }
  ]

  enabled             = true
  is_ipv6_enabled     = true
  comment             = "Some comment"
  default_root_object = "index.html"

  logging_config = {
    include_cookies = false
    bucket          = "mylogs.s3.amazonaws.com"
    prefix          = "myprefix"
  }

  aliases = ["mysite.example.com", "yoursite.example.com"]

  default_cache_behavior = {
    allowed_methods  = ["DELETE", "GET", "HEAD", "OPTIONS", "PATCH", "POST", "PUT"]
    cached_methods   = ["GET", "HEAD"]
    target_origin_id = local.s3_origin_id

    forwarded_value = {
      query_string = false

      cookies = {
        forward = "none"
      }
    }

    viewer_protocol_policy = "allow-all"
    min_ttl                = 0
    default_ttl            = 3600
    max_ttl                = 86400
  }

  ordered_cache_behaviors = [
    # Cache behavior with precedence 0
    {
      path_pattern     = "/content/immutable/*"
      allowed_methods  = ["GET", "HEAD", "OPTIONS"]
      cached_methods   = ["GET", "HEAD", "OPTIONS"]
      target_origin_id = local.s3_origin_id

    forwarded_values = {
      query_string = false
      headers      = ["Origin"]

      cookies = {
        forward = "none"
      }
    }

    min_ttl                = 0
    default_ttl            = 86400
    max_ttl                = 31536000
    compress               = true
    viewer_protocol_policy = "redirect-to-https"
  },
  # Cache behavior with precedence 1
  {
    path_pattern     = "/content/*"
    allowed_methods  = ["GET", "HEAD", "OPTIONS"]
    cached_methods   = ["GET", "HEAD"]
    target_origin_id = local.s3_origin_id

    forwarded_values = {
      query_string = false

      cookies = {
        forward = "none"
      }
    }
    min_ttl                = 0
    default_ttl            = 3600
    max_ttl                = 86400
    compress               = true
    viewer_protocol_policy = "redirect-to-https"
  }]
  
  price_class = "PriceClass_200"

  restrictions = {
    geo_restriction = {
      restriction_type = "whitelist"
      locations        = ["US", "CA", "GB", "DE"]
    }
  }

  tags = {
    Environment = "production"
  }

  viewer_certificate = {
    cloudfront_default_certificate = true
  }
}
```
